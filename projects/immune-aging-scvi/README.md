# immune-aging-scvi

Modular Snakemake pipeline for PBMC single-cell RNA-seq analysis focused on immune aging.

Stack: `scanpy` + `scvi-tools` + `CellTypist`.

## What This Demonstrates
- Reproducible, config-driven workflow design (`Snakemake` + YAML configs).
- Memory-safe single-cell processing (sparse counts, no dense graph conversion).
- Practical modeling steps used in biotech workflows: QC, doublet removal, scVI latent modeling, clustering, automated annotation.
- Recruiter-friendly outputs: `.h5ad` intermediates, plots, and summary tables.

## Pipeline
1. `ingest` -> `results/01_raw.h5ad`
2. `qc` -> `results/02_qc.h5ad`
3. `doublets` (SOLO) -> `results/03_nodoublets.h5ad`
4. `scvi_train` -> `results/04_scvi.h5ad` + `results/models/scvi_model/`
5. `cluster` -> `results/05_clustered.h5ad`
6. `annotate` (CellTypist) -> `results/06_annotated.h5ad`
7. `report` -> figures + tables + `results/reports.done`

## Quickstart (Demo)
```bash
conda env create -f environment.yml
conda activate immune-aging-scvi

snakemake -s workflows/Snakefile -c 1 --configfile config/config.demo.yaml
```

## Report Outputs
Generated by `src/report.py`:
- `results/figures/umap_leiden.png`
- `results/figures/umap_cell_type.png`
- `results/figures/qc_distributions.png`
- `results/figures/cell_type_composition.png`
- `results/tables/cell_type_counts.csv`
- `results/tables/cell_type_fractions.csv`
- `results/tables/cluster_celltype_crosstab.csv`

## Real-Data Mode
Use `config/config.real.yml` and set:
- `run.dataset: custom_h5ad`
- `paths.input_h5ad: data/raw/input.h5ad`

Detailed schema + ingestion notes: `docs/real_data.md`.

## Notes
- Default config uses CPU for portability on Windows/macOS/Linux.
- Large data files and `results/` are gitignored.
- For README showcase images, commit selected PNGs under `docs/assets/`.
